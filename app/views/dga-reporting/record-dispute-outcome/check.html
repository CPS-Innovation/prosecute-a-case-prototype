{% extends "_layouts/main.html" %}
{% set navId = 'cases' %}
{% set secondaryNavId = 'dga' %}
{% set pageName = 'Check details and record dispute outcome' %}

{% set baseUrl = "/dga-reporting/" + monthKey + "/" + policeUnitId + "/" + case.id + "/" + failureReason.id + "/record-dispute-outcome" %}

{% block beforeContent %}
  {{ govukBackLink({
    text: "Back",
    href: baseUrl + "/method" if data.recordOutcome.disputed == "Yes" else baseUrl
  }) }}
{% endblock %}

{% block content %}
  <div class="govuk-width-container">
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-two-thirds">

        <span class="govuk-caption-l">{{ case.reference }}</span>
        <h1 class="govuk-heading-l">{{ pageName }}</h1>

        <div class="govuk-inset-text">
          <h2 class="govuk-heading-s">Failure reason</h2>
          {{ failureReason.reason }}
        </div>

        {% set methodsHtml %}
          {% if data.recordOutcome.methods and data.recordOutcome.methods.length > 0 %}
            <ul class="govuk-list govuk-list--bullet">
              {% for method in data.recordOutcome.methods %}
                <li>{{ method }}</li>
              {% endfor %}
            </ul>
          {% endif %}
        {% endset %}

        {{ govukSummaryList({
          rows: [
            {
              key: { text: "Did the police dispute this failure?" },
              value: { text: data.recordOutcome.disputed },
              actions: {
                items: [{
                  href: baseUrl,
                  text: "Change",
                  visuallyHiddenText: "did the police dispute this failure"
                }]
              }
            },
            {
              key: { text: "Did CPS accept the dispute?" },
              value: { text: data.recordOutcome.cpsAccepted },
              actions: {
                items: [{
                  href: baseUrl + "/cps-accepted",
                  text: "Change",
                  visuallyHiddenText: "did CPS accept the dispute"
                }]
              }
            } if data.recordOutcome.disputed == "Yes",
            {
              key: { text: "Reason for outcome" },
              value: { text: data.recordOutcome.explanation },
              actions: {
                items: [{
                  href: baseUrl + "/reason",
                  text: "Change",
                  visuallyHiddenText: "reason for outcome"
                }]
              }
            } if data.recordOutcome.disputed == "Yes",
            {
              key: { text: "How did you discuss this dispute with the police?" },
              value: { html: methodsHtml },
              actions: {
                items: [{
                  href: baseUrl + "/method",
                  text: "Change",
                  visuallyHiddenText: "how you discussed this dispute with the police"
                }]
              }
            } if data.recordOutcome.disputed == "Yes"
          ]
        }) }}

        {% if legacyOutcome %}
          <p>This will record the outcome as ‘{{ legacyOutcome }}’.</p>
        {% endif %}

        <form method="post">
          {{ govukButton({
            text: "Record dispute outcome"
          }) }}
        </form>

      </div>
    </div>
  </div>
{% endblock %}
