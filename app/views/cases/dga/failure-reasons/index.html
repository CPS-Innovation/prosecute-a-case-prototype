{% extends "layouts/main.html" %}
{% set navId = 'cases' %}
{% set secondaryNavId = 'dga' %}
{% set pageName = case.reference %}

{% block beforeContent %}
  {{ govukBreadcrumbs({
    items: [
      {
        text: "DGA",
        href: "/cases/dga"
      },
      {
        text: monthName,
        href: "/cases/dga/" + monthKey
      },
      {
        text: policeUnitName,
        href: "/cases/dga/" + monthKey + "/" + policeUnitSlug
      },
      {
        text: case.reference
      }
    ]
  }) }}
{% endblock %}

{% block content %}
  {% include "_includes/success-banner.njk" %}

  <div class="govuk-width-container">
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-two-thirds">

        <span class="govuk-caption-l">{{ case.reference }}</span>
        <h1 class="govuk-heading-l">Record outcomes</h1>

        {% if case.dga.failureReasons.length %}
          <div class="app-list">
            {% for reason in case.dga.failureReasons %}
              <div class="app-list__item">
                <div style="display: flex; justify-content: space-between; align-items: start;">
                  <div style="flex: 1; min-width: 0;">
                    <h2 class="govuk-heading-s govuk-!-margin-bottom-1">
                      {{ reason.reason }}
                    </h2>
                    {% if reason.outcome %}
                      <p class="govuk-body-s govuk-!-margin-bottom-0" style="color: #505a5f;">
                        {{ reason.outcome }}
                      </p>
                    {% endif %}
                  </div>
                  <div style="text-align: right; white-space: nowrap; margin-left: 16px;">
                    {% if reason.outcome %}
                      {{ govukTag({
                        text: "Completed",
                        classes: "govuk-tag--grey"
                      }) }}
                    {% else %}
                      {{ govukTag({
                        text: "Not started",
                        classes: "govuk-tag--red"
                      }) }}
                    {% endif %}
                    <p class="govuk-body" style="margin-top: 8px; margin-bottom: 0;">
                      {% if reason.outcome %}
                        <a href="/cases/dga/{{ case.id }}/failure-reasons/{{ reason.id }}/record-outcome/select" class="govuk-link--no-visited-state">Change outcome</a>
                      {% else %}
                        <a href="/cases/dga/{{ case.id }}/failure-reasons/{{ reason.id }}/record-outcome/select" class="govuk-link--no-visited-state">Record outcome</a>
                      {% endif %}
                    </p>
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <p class="govuk-body">No failure reasons found for this case.</p>
        {% endif %}
      </div>
    </div>
  </div>

{% endblock %}
