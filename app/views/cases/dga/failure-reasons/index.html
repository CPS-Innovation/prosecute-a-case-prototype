{% extends "layouts/main.html" %}
{% set navId = 'cases' %}
{% set secondaryNavId = 'dga' %}
{% set pageName = case.reference %}

{% block beforeContent %}
  {{ govukBreadcrumbs({
    items: [
      {
        text: "Director General Assessment (DGA)",
        href: "/cases/dga"
      },
      {
        text: monthName,
        href: "/cases/dga/" + monthKey
      },
      {
        text: 'Non-compliant DGA cases',
        href: "/cases/dga/" + monthKey + "/" + policeUnitId
      },
      {
        text: 'Decisions'
      }
    ]
  }) }}
{% endblock %}

{% block content %}
  {% include "_includes/success-banner.njk" %}

  <div class="govuk-width-container">
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-two-thirds">
        <span class="govuk-caption-l">{{ case.reference }}</span>
        <h1 class="govuk-heading-l">
          Decisions
          {{ govukTag({
            text: reportStatus,
            classes: reportStatus | completionStatusTagClass
          }) }}
        </h1>

        <p class="govuk-body">{{ outcomesCompleted }} of {{ outcomesTotal }} decision{{ "s" if outcomesTotal != 1 }} recorded.</p>

        {% for reason in case.dga.failureReasons %}

            <h2 class="govuk-heading-m govuk-!-margin-top-7">
              {{ reason.reason }}
            </h2>

            {% if not reason.outcome %}
              {{ govukButton({
                text: "Record decision",
                href: "/cases/dga/:caseId/failure-reasons/:reasonId/record-outcome/outcome" | replace(':caseId', case.id) | replace(':reasonId', reason.id)
              }) }}
            {% else %}
              {% set methodsHtml %}
                {% if reason.methods %}
                  <ul class="govuk-list govuk-list--bullet">
                    {% for method in reason.methods.split(', ') %}
                      <li>{{ method }}</li>
                    {% endfor %}
                  </ul>
                {% else %}
                  -
                {% endif %}
              {% endset %}

              {{ govukSummaryList({
                rows: [
                  {
                    key: {
                      text: "Decision"
                    },
                    value: {
                      text: reason.outcome
                    },
                    actions: {
                      items: [
                        {
                          href: "/cases/dga/:caseId/failure-reasons/:reasonId/record-outcome/outcome" | replace(':caseId', case.id) | replace(':reasonId', reason.id),
                          text: "Change",
                          visuallyHiddenText: "outcome"
                        }
                      ]
                    }
                  },

                  {
                    key: { text: "Reason for this decision" },
                    value: { text: reason.details if reason.details else "-" },
                    actions: {
                      items: [
                        {
                          href: "/cases/dga/:caseId/failure-reasons/:reasonId/record-outcome/decision-explanation" | replace(':caseId', case.id) | replace(':reasonId', reason.id),
                          text: "Change",
                          visuallyHiddenText: "explanation"
                        }
                      ]
                    }
                  } if reason.outcome != "Not disputed",

                  {
                    key: { text: "How did you communicate with the police to make this decision?" },
                    value: { html: methodsHtml },
                    actions: {
                      items: [
                        {
                          href: "/cases/dga/:caseId/failure-reasons/:reasonId/record-outcome/decision-method" | replace(':caseId', case.id) | replace(':reasonId', reason.id),
                          text: "Change",
                          visuallyHiddenText: "methods"
                        }
                      ]
                    }
                  } if reason.outcome != "Not disputed"
                ]
              }) }}
            {% endif %}
          
        {% endfor %}
      </div>
    </div>
  </div>

{% endblock %}
